
name: Nightly Build

on:
  schedule:
    # Cron is in UTC
    - cron: "30 18 * * *"   # 18:30 UTC = 00:00 IST (GMT+5:30)
  workflow_dispatch:

jobs:
  fetch_head_sha:
    runs-on: ubuntu-latest
    outputs:
      sha: ${{ steps.top_sha.outputs.sha }}
    steps:
      - name: Get latest commit SHA from kernel repo (branch)
        id: top_sha
        env:
          KERNEL_REPO: https://github.com/qualcomm-linux/kernel.git
          KERNEL_BRANCH: qcom-6.18.y
        run: |
          sha=$(git ls-remote "$KERNEL_REPO" "refs/heads/$KERNEL_BRANCH" | awk '{print $1}')
          echo "sha=$sha" >> "$GITHUB_OUTPUT"
          echo "Top commit: $sha"

  post_merge_yocto:
    needs: fetch_head_sha
    uses: ./.github/workflows/post-merge-yocto.yml
    with:
      sha: ${{ needs.fetch_head_sha.outputs.sha }}
      ref: "qcom-6.18.y"
      repo: "qualcomm-linux/kernel"


